{% load static %}

<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Отзывы — RiviKiwi</title>
  <link rel="icon" href="{% static 'assets/images/icons/rivikiwi-logo.svg' %}" type="image/x-icon">
  <link rel="stylesheet" href="{% static 'assets/css/reviews.css' %}">
  <link rel="stylesheet" href="{% static 'assets/css/main-page-style.css' %}">
</head>
<body>

<!-- ===== HEADER (как везде) ===== -->
<header class="site-header">
  <div class="container header-top">

    <a href="{% url "catalog:home" %}" class="logo">
      <span class="logo-text">Rivi<span class="green-text">Kiwi</span></span>
    </a>

    {% if not user.is_authenticated %}
      <a href="{% url 'users:login' %}" class="btn btn-primary">
          <svg width="15" height="18" viewBox="0 0 15 18" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M14 17C14 13.5636 11.0899 10.7778 7.5 10.7778C3.91015 10.7778 1 13.5636 1 17M7.5 8.11111C5.44866 8.11111 3.78571 6.51924 3.78571 4.55556C3.78571 2.59188 5.44866 1 7.5 1C9.55131 1 11.2143 2.59188 11.2143 4.55556C11.2143 6.51924 9.55131 8.11111 7.5 8.11111Z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span>Войти</span>
      </a>
    {% else %}
      <div class="account-wrapper" onclick="showAccountMenu()">
          <svg width="15" height="18" viewBox="0 0 15 18" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M14 17C14 13.5636 11.0899 10.7778 7.5 10.7778C3.91015 10.7778 1 13.5636 1 17M7.5 8.11111C5.44866 8.11111 3.78571 6.51924 3.78571 4.55556C3.78571 2.59188 5.44866 1 7.5 1C9.55131 1 11.2143 2.59188 11.2143 4.55556C11.2143 6.51924 9.55131 8.11111 7.5 8.11111Z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <div class="account-dropdown" id="accountDropdown">
              <span class="account-name">
                  <h3>{{ user.username }}</h3>
              </span>
              <div class="acc-menu-options">
                  <a href="{% url "users:self_profile" %}" class="account-option">Профиль</a>
              {% if user.is_staff or user.is_admin %}
                  <a href="{% url 'admin:index' %}" class="account-option">Админ-панель</a>
              {% endif %}
              </div>
                  <a href="{% url 'users:logout' %}" class="account-option exit-option">Выйти</a>
          </div>
      </div>
    {% endif %}

  </div>
</header>

<!-- ===== MAIN ===== -->
<main class="container reviews-page">
<div id="jq-notification" class="custom-notification"></div>
  <!-- ===== TABS ===== -->
  <div class="reviews-tabs">
    <button class="tab active" data-tab="all">Все отзывы</button>
    <button class="tab" data-tab="my">Мои отзывы</button>
  </div>


  <!-- ===== WRITE REVIEW ===== -->
  <div class="write-review-card">

  <h3>Написать отзыв</h3>
  <form action="{% url "reviews:create_review" seller_username %}" method="post">
    {% csrf_token %}
  <!-- Выбор рейтинга -->
    <div class="rating-select">
      <span class="star" data-value="1">★</span>
      <span class="star" data-value="2">★</span>
      <span class="star" data-value="3">★</span>
      <span class="star" data-value="4">★</span>
      <span class="star" data-value="5">★</span>
    </div>

    <!-- Текст отзыва -->
    <textarea
      class="review-text-area"
      name="text"
      placeholder="Поделитесь впечатлениями о продавце...">
    </textarea>

    <!-- Скрытое поле с оценкой -->
    <input type="hidden" id="ratingValue" name="rating" value="0">

    <!-- Кнопка -->
    <button type="submit" class="btn btn-primary submit-review-btn">
      Отправить отзыв
    </button>
  </form>
</div>


  <!-- ===== REVIEWS LIST ===== -->
  <div class="reviews-list">

    {% for review in reviews %}
      <div class="review-card {% if review.consumer == user %}my-review{% endif %}">
        <div class="review-header">
          <img src="{% static 'assets/images/users/ava.png' %}" class="review-avatar">
          <div>
            <div class="review-name">{% if review.consumer == user %}Вы{% else %}{{ review.consumer }}{% endif %}</div>
            <div class="review-meta">
              <svg width="17" height="17" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M9.17367 1.02647C9.43547 0.441354 9.56643 0.148797 9.74873 0.0587052C9.90705 -0.0195684 10.093 -0.0195684 10.2513 0.0587052C10.4336 0.148797 10.5646 0.441354 10.8264 1.02647L12.9117 5.68699C12.9892 5.85996 13.0279 5.94644 13.0878 6.01267C13.1407 6.07128 13.2055 6.11815 13.2778 6.15024C13.3596 6.18651 13.4541 6.19645 13.6432 6.21632L18.7371 6.7519C19.3766 6.81914 19.6963 6.85275 19.8387 6.99762C19.9623 7.12344 20.0197 7.29964 19.9939 7.47385C19.9643 7.67438 19.7255 7.88876 19.2478 8.31765L15.4427 11.7336C15.3015 11.8604 15.2308 11.9238 15.1862 12.0009C15.1466 12.0693 15.1218 12.1451 15.1136 12.2236C15.1042 12.3122 15.1239 12.4048 15.1633 12.5901L16.2261 17.5816C16.3596 18.2083 16.4263 18.5216 16.332 18.7012C16.25 18.8573 16.0996 18.9662 15.9253 18.9956C15.7247 19.0294 15.4462 18.8694 14.8891 18.5493L10.452 15.9999C10.2874 15.9053 10.205 15.8581 10.1175 15.8395C10.04 15.8232 9.95998 15.8232 9.88251 15.8395C9.79498 15.8581 9.71265 15.9053 9.54799 15.9999L5.11095 18.5493C4.5539 18.8694 4.27537 19.0294 4.07474 18.9956C3.90046 18.9662 3.75 18.8573 3.66808 18.7012C3.57378 18.5216 3.64049 18.2083 3.77392 17.5816L4.83669 12.5901C4.87614 12.4048 4.89586 12.3122 4.88649 12.2236C4.8782 12.1451 4.85347 12.0693 4.81389 12.0009C4.76916 11.9238 4.69855 11.8604 4.55734 11.7336L0.752309 8.31765C0.274608 7.88876 0.035752 7.67438 0.00605475 7.47385C-0.0197296 7.29964 0.0377312 7.12344 0.161383 6.99762C0.30374 6.85275 0.6235 6.81914 1.26302 6.7519L6.35689 6.21632C6.54596 6.19645 6.64048 6.18651 6.72222 6.15024C6.79454 6.11815 6.85929 6.07128 6.91229 6.01267C6.97217 5.94644 7.01087 5.85996 7.08828 5.68699L9.17367 1.02647Z" fill="#90C825"/>
              </svg>
              {{ review.rating }} · 12 января 2024
            </div>
          </div>
        </div>

        <p class="review-text">
          {{ review.text }}
        </p>

        {% if review.consumer == user %}
        <!-- EDIT REVIEW FORM (скрыта по умолчанию) -->
          <div class="edit-review-form">
            <form action="{% url "reviews:edit_review" %}" method="post">
              {% csrf_token %}
              <!-- выбор рейтинга -->
              <div class="rating-select edit-rating">
                <span class="star" data-value="1">★</span>
                <span class="star" data-value="2">★</span>
                <span class="star" data-value="3">★</span>
                <span class="star" data-value="4">★</span>
                <span class="star" data-value="5">★</span>
              </div>

              <input type="hidden" id="ratingEditValue" name="rating" value="{{ review.rating }}">
              
              <textarea class="review-text-area edit-textarea" name="text">
                {{review.text}}
              </textarea>

              <input type="hidden" name="review_id" value="{{ review.id }}">

              <div class="edit-review-actions">
                <button type="submit" class="review-btn apply-btn">Применить</button>
                <button class="review-btn cancel-btn">Отмена</button>
              </div>
            </form>
          </div>

        <div class="review-actions">
          <button class="review-btn edit-btn">Изменить</button>
          <button class="review-btn delete-btn"
            data-review-id="{{ review.id }}"
            data-url="{% url 'reviews:delete_review' %}">Удалить</button>
        </div>
        {% endif %}
      </div>
    {% endfor %}

  </div>

</main>

<script src="{% static 'assets/js/reviews.js' %}"></script>
<script src="{% static 'assets/js/main-page-scripts.js' %}"></script>
<script src="{% static 'assets/js/jquery/jquery-3.7.0.min.js' %}"></script>
<script src="{% static 'assets/js/jquery-ajax.js' %}"></script>

</body>
</html>
